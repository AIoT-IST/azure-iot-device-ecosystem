---
platform: ubuntu 16.04
device: awlbox
language: c
---

# AWLBOX: Getting Started
---
# Table of Contents

-   [Introduction](#Introduction)
-   [Step 1: Prerequisites](#Prerequisites)
-   [Step 2: AWL IoT API Credentials](#IoTAPI)
-   [Step 3: Prepare your Device](#PrepareDevice)
-   [Step 4: Test for Azure IoT Edge on device](#Manual)
-   [Step 5: Next Steps](#NextSteps)
-   [Step 6: Troubleshooting](#Step-5-Troubleshooting)

<a name="Introduction"></a>
# Introduction

**About this document**

This document describes the setup and test instructions for AWLBOX. 

Once an AWLBOX is received, it has to be registered to a specific account (Customer) with AWL. 

Upon registration, the device will be activated on the server side. The activation status can be checked simply with an API call. Usually if the data provided in registration is correct and the device is connected to Internet, the device can be activated without delay.

After succesful registration and activation, the device is now ready. The API calls provided in this document can now be executed.

The steps achieved by following this document are:
-   Configuring Azure IoT Hub
-   Registering your IoT device
-   Confirm client component by testing its real-time response capability 

<a name="Prerequisites"></a>
# Step 1. Prerequisites

Please send a mail to 'iot.support@awl.co.jp' containing the user details. These details are processed and you will be sent a mail provided with an ```AccessToken```. This AccessToken is used for authenticating all the requests made to AWL server.

Please be sure to include the following:
-   Company Name or Customer Name
-   Contact Email (The ``CustomerId`` for this account will be provided by us)
-   Address
-   Phone Number

<a name="IoTAPI"></a>
# Step 2. AWL IoT API Credentials

AWL IoT API provides the interface to register your device, query the live status and other relevant information.

### Endpoint
The URL Endpoint is as follows:
```
http://awl-iot.japaneast.cloudapp.azure.com/api/v2/
```
<a name="AuthSection"></a>
### Authentication

For all the requests made to AWL IoT API, the authentication mechanism used is Digest Authentication. The credentials that are to be used for Authentication are as follows:
- Username: Corresponds to the ``customerId`` generated by AWL *********@cust.awl.co.jp and provided to the customer.
- Password: Also provided by AWL during registration, is identified as the ``AccessToken``

Refer to the [Prerequisites Section](#Prerequisites) for procedure involved to obtain these credentials

<a name="PrepareDevice"></a>
# Step 3. Prepare your Device

Start the setup of an AWLBOX by registering your device in the AWL Server.
The device registration requires two things for successful completion.
1. customerId to which the device will be linked to. 
2. Serial Number(deviceId) of the device. 

```customerId``` is the email address of the customer. Serial Number (```deviceId```), which is essential for linking the device to the userAccount can be found on the label attached to the box.
```
POST http://awl-iot.japaneast.cloudapp.azure.com/api/v2/register/
```

### Request Body
| Name        | Required | Description                       |
|-------------|----------|-----------------------------------|
| ```customerId```          | TRUE     | Email address of the customer |
| ```deviceId```          | TRUE     | Id of the device (Serial Number) to be registered |

For Authentication, Refer to [Authentication](#AuthSection) in Step 2. 

### Request Template
```json
[
    {
        "customerId":"{emailAddress}",
        "deviceId":"{deviceId}"
    }
]
```
### Example Request
```json
[
    {
        "customerId":"tank@cust.awl.co.jp",
        "deviceId":"FB100ABK021C"
    }
]
```
### Response
| Name   | Type   | Description         |
|--------|--------|---------------------|
| ```200 OK``` | ResponseObject[] | An Array of ResponseObjects |
### Response Template
```json
[
    {
        "status": "{status}",
        "message": "{status message}"
    }
]
```
### Response Object
| Name   | Type   | Description         |
|--------|--------|---------------------|
| ```status``` | string | Status code |
| ```message``` | string | Message from Server |

### Example Response
```json
[
    {
        "status": "1",
        "message": "Device Registered succesfully"
    }
]
```
<a name="Manual"></a>
# Step 4. Test for Azure IoT Edge on device
# Device Usage
Once the registration call is completed succesfully, the device can be used for supported functions requested by the customer.
- ## Get Status
Device status call returns device details from the server.

If the connectionState is 'Connected' then the device is linked to the AWLServer. If it is yet 'Disconnected' even after succesful registration, check for any Internet problems in the network to which the device is connected to.

```
GET http://awl-iot.japaneast.cloudapp.azure.com/api/v2/status/
```

### Request Body
| Name        | Required | Description                       |
|-------------|----------|-----------------------------------|
| ```deviceId```          | TRUE     | Id of the device (Serial Number) |

For Authentication, Refer to [Authentication](#AuthSection) in Step 2. 
### Request Template
```json
[
    {
        "deviceId":"{deviceId}"
    }
]
```
### Example Request
```json
[
    {
        "deviceId": "FB100ABK021C"
    }
]
```

### Response
| Name   | Type   | Description         |
|--------|--------|---------------------|
| ```200 OK``` | Device | Device details JSON |

### Response Template
```json
[
    {
        "deviceId": "{deviceId}",
        "connectionState": "{Connected/Disconnected}",
        "status": "{enabled/disabled}",
        "connectionStateUpdatedTime": "{timestamp}",
        "statusUpdatedTime": "{timestamp}"
    }
]
```
### Device details JSON
| Name                       | Type                        | Description                            |
|----------------------------|-----------------------------|----------------------------------------|
| ```deviceID```                   | string                      | Device ID                              |
| ```connectionState```            | enum:Connected/Disconnected | Shows if device is connected or not    |
| ```status```                     | enum:enabled/disabled       | Shows if device is enabled or not      |
| ```connectionStateUpdatedTime``` | string                      | Time at which connection state updated |
| ```statusUpdatedTime```          | string                      | Time at which status updated           |

### Example Response
```json
[
    {
        "deviceId": "FB100ABK021C",
        "connectionState": "Connected",
        "status": "enabled",
        "connectionStateUpdatedTime": "2020-07-28T22:10:14.1980409Z",
        "statusUpdatedTime": "0001-01-01T00:00:00Z"
    }
]
```
- ## Check the modules on the device
Returns the list of modules that are present on the device.
```
GET http://awl-iot.japaneast.cloudapp.azure.com/api/v2/modules/
```
### Request Body
| Name        | Required | Description                       |
|-------------|----------|-----------------------------------|
| ```deviceId```          | TRUE     | Id of the device (Serial Number) |

For Authentication, Refer to [Authentication](#AuthSection) in Step 2. 

### Request Template
```json
[
    {
        "deviceId":"{deviceId}"
    }
]
```
### Example Request
```json
[
    {
        "deviceId": "FB100ABK021C"
    }
]
```

### Response
| Name   | Type   | Description         |
|--------|--------|---------------------|
| ```200 OK``` | Module[] | An array of modules |

### Response Template
Response contains 'n' array items for 'n' modules on the device.
```json
[
    {
        "moduleId": "{moduleId}",
        "managedBy": "{managedBy}",
        "deviceId": "{deviceId}",
        "connectionState": "{Connected/Disconnected}",
        "connectionStateUpdatedTime": "{timestamp}"
    }
                ...
    {
        "moduleId": "{moduleId}",
        "managedBy": "{managedBy}",
        "deviceId": "{deviceId}",
        "connectionState": "{Connected/Disconnected}",
        "connectionStateUpdatedTime": "{timestamp}"
    }
]
```
### Module details JSON
| Name                       | Type                        | Description                            |
|----------------------------|-----------------------------|----------------------------------------|
| ```moduleId```                   | string                      | Module ID                              |
| ```managedBy```                  | string                      | Name of the Service that manages the current module                                        |
| ```deviceID```                   | string                      | Device ID                              |
| ```connectionState```            | enum:Connected/Disconnected | Shows if device is connected or not    |
| ```connectionStateUpdatedTime``` | string                      | Time at which connection state updated |
### Example Response
```json
[
    {
        "moduleId": "$edgeAgent",
        "managedBy": null,
        "deviceId": "FB100ABK021C",
        "connectionState": "Disconnected",
        "connectionStateUpdatedTime": "0001-01-01T00:00:00Z"
    },
    {
        "moduleId": "$edgeHub",
        "managedBy": "iotEdge",
        "deviceId": "FB100ABK021C",
        "connectionState": "Connected",
        "connectionStateUpdatedTime": "2020-07-28T12:07:59.1756237Z"
    }
]
```
- ## Deploy Modules
Deploy modules call set the modules on the AWLBOX. It requires the deviceId of the AWLBOX to which the modules have to be deployed in the request along with Authentication.
 
On succesful completion of the request, 'SimulatedTemperatureSensor' Module is deployed on the AWLBOX.

```
POST http://awl-iot.japaneast.cloudapp.azure.com/api/v2/setModules/
```

### Request Body
| Name        | Required | Description                       |
|-------------|----------|-----------------------------------|
| ```deviceId```          | TRUE     | Id of the device (Serial Number) |

For Authentication, Refer to [Authentication](#AuthSection) in Step 2. 
### Request Template
```json
[
    {
        "deviceId":"{deviceId}"
    }
]
```
### Example Request
```json
[
    {
        "deviceId": "FB100ABK021C"
    }
]
```
### Response
| Name   | Type   | Description         |
|--------|--------|---------------------|
| ```200 OK``` | ResponseObject[] | An Array of ResponseObjects |
### Response Template
```json
[
    {
        "status": "{status}",
        "message": "{status message}"
    }
]
```
### Response Object
| Name   | Type   | Description         |
|--------|--------|---------------------|
| ```status``` | string | Status code |
| ```message``` | string | Message from Server |

### Example Response
```json
[
    {
        "status": 1,
        "message": "FB100ABK021C - Device Module Updated"
    }
]
```

<a name="NextSteps"></a>
# Step 5: Next steps

Once you have confirmed the device is running and responding then the registration & setup process is completed.

<a name="Step-5-Troubleshooting"></a>
# Step 6: Troubleshooting

Please contact engineering support on **<mailto:iot.support@awl.co.jp>** for help with troubleshooting.